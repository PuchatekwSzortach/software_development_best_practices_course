{% import "sections_macros.html" as sections_macros %}

{% macro site_header() %}
<div class="jumbotron text-center card mt-4 p-4 shadow-lg">
    <h1>Software development best practices</h1>
    <h2>AI Okinawa</h2>
    <h2>Jakub “Kuba” Kolodziejczyk</h2>
</div>
{% endmacro %}


{% macro card_header_style() %}
"h3 card-header text-center bg-success text-white"
{% endmacro %}


{% macro introduction() %}
    {{ sections_macros.kuba_profile() }}
    <br><br><br>
    {{ sections_macros.course_content_outline() }}
{% endmacro %}

{% macro testing() %}
<div class="shadow-lg">
    <div class={{ card_header_style() }}>Testing</div>
    <div class="m-4">
        <ul class="list-group">
            <li class="list-group-item">It's hard to write complex code correctly</li>
            <li class="list-group-item">Corner cases</li>
            <li class="list-group-item">Quickly notice bugs due to changes in underlying code</li>
            <li class="list-group-item">Refactor with confidence</li>
            <li class="list-group-item">Executable documentation</li>
            <li class="list-group-item">Leads to better design</li>
        </ul>

        <br>
        <div class="h3 text-center">Unit testing</div>

        <ul class="list-group">
            <li class="list-group-item"><code>get_factorial(x)</code></li>
            <li class="list-group-item"><code>get_faces(image)</code></li>
        </ul>

        <br><br>
        <div class="h3 text-center">Acceptance testing</div>

        <ul class="list-group">
            <li class="list-group-item"><code>test_factorial_endpoint_with_simple_input()</code></li>
            <li class="list-group-item">Tests application starts up correctly</li>
            <li class="list-group-item">Tests environment - server has correctly libraries installed, etc</li>
            <li class="list-group-item">Tests services connections - we can connect to database, etc</li>
            <li class="list-group-item">Tests all software components (code, databases, external services, etc) work correctly together</li>
            <li class="list-group-item">Used to test "happy path" - typical interactions user has with software</li>
        </ul>

        <br>
    </div>
</div>
{% endmacro %}


{% macro version_control() %}
<div class="shadow-lg">
    <div class={{ card_header_style() }}>Version control</div>

    <br><br>
    <div class="h2 text-center">Should I use git?</div><br>

    <img class="mx-auto d-block" src="https://media0.giphy.com/media/XuBJvrKHutnkQ/giphy.gif">
    <br>

    <div class="m-4">
        <ul class="list-group">
            <li class="list-group-item">What is version control?</li>
            <li class="list-group-item">Branches</li>
            <li class="list-group-item">Merges</li>
            <li class="list-group-item">Resolving conflicts</li>
            <li class="list-group-item">Why using version control in personal project?<br>
                &#8226 easily revert to last known state<br>
                &#8226 don't worry about breaking something up<br>
                &#8226 check what change introduced a problem (diff)
            </li>
            <li class="list-group-item">Why using version control in a team?<br>
                &#8226 all of the above<br>
                &#8226 don't step on each other's toes (branches)<br>
                &#8226 combine code in a controlled manner (merges)<br>
                &#8226 pull requests<br>
                &#8226 code reviews<br>
                &#8226 continuous integration
            </li>
        </ul>

        <br>
    </div>
</div>
{% endmacro %}


{% macro environment_sandboxing() %}
<div class="shadow-lg">
    <div class={{ card_header_style() }}>Sandboxing</div>

    <div class="m-4">

        <div class="h3 text-center">Environment sandboxing</div>

        <br>
        <img class="mx-auto d-block" src="/static/images/say-works-on-my-machine-again-i-dare-you.jpg">
        <br>

        <br>

        <ul class="list-group">
            <li class="list-group-item">Environment resources<br>
                &#8226 Executables<br>
                &#8226 Compilers<br>
                &#8226 Libraries
            </li>
            <li class="list-group-item">Problems in not managing resources per project<br>
                &#8226 Can't easily reproduce environment on a different machine<br>
                &#8226 Environment update on one project changes environment definition on another project<br>
                &#8226 Environment update on one project can cause bugs on another project<br>
            </li>
            <li class="list-group-item">Solution - environment management!<br>
                &#8226 Project keeps an environment definition file that defines all resources and their versions<br>
                &#8226 All resources are installed locally per project, rather than shared across the system<br>
                &#8226 Environment definition file is version controlled, just like any other code<br>
                &#8226 Using environment definition, exact environment can be reproduced on another machine<br>
            </li>
            <li class="list-group-item">Sample environment definition file from <code>Anaconda</code><br>
        </ul>


        <br><br>

        <div class="h3 text-center">Services sandboxing</div>

        <br><br>

        <ul class="list-group">
            <li class="list-group-item">Services used on a typical web project<br>
                &#8226 Database<br>
                &#8226 File storage<br>
                &#8226 Web server configuration
            </li>
            <li class="list-group-item">Risks in modifying shared services<br>
                &#8226 Break production<br>
                &#8226 Break development for other engineers<br>
                &#8226 Transient bugs<br>
            </li>
            <li class="list-group-item">Solution - services sandboxes!<br>
                &#8226 Each developer uses a local instance of service per project<br>
                &#8226 Most popular tool for services sandboxing: <code>Docker</code>
            </li>
        </ul>

        <br>

    </div>
</div>
{% endmacro %}


{% macro configuration_management() %}
<div class="shadow-lg">
    <div class={{ card_header_style() }}>Configuration management</div>

    <div class="m-4">

        <br>

        <div class="h3 text-center">Typical environments</div>

        <ul class="list-group">
            <li class="list-group-item">Development - one per engineer</li>
            <li class="list-group-item">Testing - checks code works on a machine with known configuration, not just your machine</li>
            <li class="list-group-item">Staging - as close to production as similar, but not used by client (if you have to mess up, do it there)</li>
            <li class="list-group-item">Production - client facing</li>
        </ul>

        <br><br>

        <div class="h3 text-center">Parts that differ between environments</div>

        <ul class="list-group">
            <li class="list-group-item">Database and other services urls</li>
            <li class="list-group-item">Paths to resources</li>
            <li class="list-group-item">Ports application uses</li>
            <li class="list-group-item">Logging options</li>
        </ul>

        <br><br>

        <div class="h3 text-center">Options for passing configuration to application</div>

        <ul class="list-group">
            <li class="list-group-item">Command line arguments</li>
            <li class="list-group-item">Environment variables</li>
            <li class="list-group-item">Configuration file</li>
        </ul>

        <br><br>

        <div>
            <div class="h3 text-center">Command line arguments</div>

            Passing configuration to application:<br>
            <code>./myapp --database-url=... --port=123 ---loglevel=info</code><br>

            <br>

            Using configuration inside application:<br><br>
            {{ sections_macros.configuration_management_with_command_line_arguments_code_usage() }}

            <b>Disadvantages:</b><br>
            &#8226 a lot of typing, thus not very convenient<br>
            &#8226 easy to make a mistake<br>
            &#8226 doesn't scale<br>
        </div>

        <br><br>

        <div>
            <div class="h3 text-center">Environment variables:</div><br>

            Passing configuration to application:<br>
            <code>DATABASE_URL=... PORT=123 LOGLEVEL=info ./myapp</code><br>
            Suffers from exactly same problems as above<br><br>

            <b>OR</b><br><br>

            {{ sections_macros.configuration_management_with_environment_variables() }}

            Then from command line:<br>
            <code>
                source ~/.bashrc<br>
                ./myapp
            </code>

            <br><br>

            Using configuration inside application:<br><br>
            {{ sections_macros.configuration_management_with_environment_variables_code_usage() }}

            <b>Disadvantages:</b><br>

            &#8226 Configuration isn't stored in project, thus can't be version controlled<br>
            &#8226 Environment variables are essentially globals, so it's hard to see all inputs to a given piece of code<br>
        </div>

        <br><br>

        <div>

            <div class="h3 text-center">Configuration file:</div><br>

            Define configuration file:<br><br>
            {{ sections_macros.configuration_management_with_configuration_file() }}

            Passing configuration to application:<br>
            <code>./myapp --config-path=./configuration/development_config.yaml</code><br><br>

            Using configuration inside application:<br><br>
            {{ sections_macros.configuration_management_with_configuration_file_code_usage() }}

            <b>Advantages:</b><br>

            &#8226 Version controlled<br>
            &#8226 Easy to add new options<br>
            &#8226 Visible in code<br>

        </div>

        <br><br>

    </div>
</div>
{% endmacro %}


{% macro continuous_integration() %}
<div class="shadow-lg">
    <div class={{ card_header_style() }}>Continuous integration</div>

    <div class="m-4">

        <div class="h3 text-center">What is a continuous integration?</div><br>

        <ul class="list-group">
            <li class="list-group-item">A systematic process for frequently merging new code into main codebase</li>
            <li class="list-group-item">Developers push their code to master branch often</li>
            <li class="list-group-item">Each push is run through automated tests and results are visible to everyone in company</li>
            <li class="list-group-item">Bad code is automatically rejected by integration server</li>
        </ul>

        <br><br>

        <div class="h3 text-center">What problems it tries to solve</div><br>

        <ul class="list-group">
            <li class="list-group-item">Large and difficult merges</li>
            <li class="list-group-item">Developers working on old code</li>
            <li class="list-group-item">Bugs surfacing weeks after they were introduced</li>
        </ul>

        <br><br>

        <div class="h3 text-center">Typical stages in continuous integration pipeline</div><br>

        <ul class="list-group">
            <li class="list-group-item">Commit stage<br>
                &#8226 Build executables and other deliverables (e.g. documentation)<br>
                &#8226 Run static code analysis<br>
                &#8226 Run unit tests
            </li>
            <li class="list-group-item">Acceptance/Integration stage<br>
                &#8226 Run tests interacting with the app (implies app has to be started for each test)<br>
                &#8226 Run database migration tests
            </li>
            <li class="list-group-item">Optional - Performance profiling stage<br>
                &#8226 Throughput stress tests<br>
                &#8226 Load stress tests<br>
            </li>
            <li class="list-group-item">Manual - code review stage<br>
                &#8226 Lead engineer or other senior engineer reviews the code<br>
            </li>
        </ul>

        <br><br>

        <div class="h3 text-center">When and where should continuous integration pipeline be triggered</div><br>

        <ul class="list-group">
            <li class="list-group-item">Automatically on integration server on every commit to master</li>
            <li class="list-group-item">Automatically on integration server on every pull request</li>
            <li class="list-group-item">Automatically on integration server on every commit to feature branch</li>
            <li class="list-group-item">Manually on integration server for any of above at engineer's request</li>
            <li class="list-group-item">Manually on local machine at engineer's request</li>
        </ul>

        <br><br>

        <div class="h3 text-center">Popular continuous integration tools</div><br>

        <ul class="list-group">
            <li class="list-group-item">Jenkins</li>
            <li class="list-group-item">GoCD</li>
            <li class="list-group-item">Travis CI</li>
            <li class="list-group-item">Quite a few others...</li>
        </ul>

        <br><br>

    </div>
</div>
{% endmacro %}


{% macro code_reviews() %}
<div class="shadow-lg">
    <div class={{ card_header_style() }}>Code reviews</div>

    <div class="m-4">

        <div class="h3 text-center">Code review process</div><br>

        <ul class="list-group">
            <li class="list-group-item">Developer works on code in her own branch</li>
            <li class="list-group-item">Once developer finished a logical piece of work, sends pull request</li>
            <li class="list-group-item">Code is first reviewed by automatic tests - see <code>continuous integration</code></li>
            <li class="list-group-item">A senior engineer reviews code - reads it, highlights issues if any</li>
            <li class="list-group-item">
                If code passes review, it's merged to master. Else developer fixes any issues and sends a new pull request
            </li>
        </ul>

        <br><br>

        <div class="h3 text-center">Benefits of code reviews</div><br>

        <ul class="list-group">
            <li class="list-group-item">Catches bugs before they make it to master branch</li>
            <li class="list-group-item">Increases codebase understanding among team members</li>
            <li class="list-group-item">
                Training for junior (and senior!) engineers - reviewer looks at your code and gives you feedback
            </li>
            <li class="list-group-item">
                More cohesive architecture - reviewer can enforce similar style to whole codebase
            </li>
        </ul>

        <br><br>

        <img class="mx-auto d-block" src="https://media.giphy.com/media/TDMwAs1KQVQWI/giphy.gif"><br>
        <div class="h5 text-center text-secondary">
            Final boss one the quest to merge your code to master - the fearsome reviewer!
        </div>
    <br>

    </div>
</div>
{% endmacro %}


{% macro continuous_deployment() %}
<div class="shadow-lg">
    <div class={{ card_header_style() }}>Continuous deployment</div>

    <div class="m-4">

        <br>

        <ul class="list-group">
            <li class="list-group-item">Release often, fail fast</li>
            <li class="list-group-item">Continuous deployment is continuous integration taken to its logical conclusion</li>
        </ul>

        <br><br>

        <div class="h3 text-center">Common reasons for deployments failures</div><br>

        <ul class="list-group">
            <li class="list-group-item">It's a complex manual process and someone gets a step wrong, e.g.<br>
                &#8226 forgets to rewrite symbolic link<br>
                &#8226 forgets to update environment<br>
                &#8226 uploads wrong external resources configuration (e.g. development config instead of production config)<br>
                &#8226 doesn't link new version to correct load balancer<br>
                &#8226 etc

            </li>
            <li class="list-group-item">New code doesn't handle existing data correctly - a regression bug</li>
            <li class="list-group-item"><code>Bad database refactoring</code></li>
        </ul>

        <br><br>

        <div class="h3 text-center">Benefits of continuous deployment</div><br>

        <ul class="list-group">
            <li class="list-group-item">Smaller window of change == smaller chance of failure</li>
            <li class="list-group-item">When you do fail, you have a smaller amount of code to look at to find the problem</li>
            <li class="list-group-item">Quicker time to marker</li>
            <li class="list-group-item">Forces deployment process automation - which decreases manual process risk</li>
            <li class="list-group-item">If you can deploy fast, then you can recover fast too</li>
        </ul>

        <br><br>

        <div class="h3 text-center">Deployment best practices</div><br>

        <ul class="list-group">
            <li class="list-group-item">Staging environment and production environment<br>
                &#8226 staging environment should be as similar to production as possible - real database, real load balancer, etc<br>
                &#8226 but - <code>never use production data in staging!</code><br>

            </li>
            <li class="list-group-item">Automate as much as possible</li>
            <li class="list-group-item">Sanity tests for production environment</li>
        </ul>

        <br><br>

    </div>
</div>
{% endmacro %}


{% macro finishing_slide() %}
<img src="/static/images/ai_okinawa_finishing_slide.jpg" width="100%" class="shadow-lg"></div>
{% endmacro %}
